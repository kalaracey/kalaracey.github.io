<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://kalaracey.github.io/favicon.ico><link rel=stylesheet href=/css/style.min.css><title>How Short Links Work</title></head><body><header id=banner><h2><a href=https://kalaracey.github.io>Kyle Laracey</a></h2><nav><ul><li><a href=/about/ title>about</a></li><li><a href=/ title>posts</a></li></ul></nav></header><main id=content><article><header id=post-header><h1>How Short Links Work</h1><div><time>April 18, 2022</time></div></header><p>In some organizations, you may have seen &ldquo;short links&rdquo; like</p><p><code>http://go/foo-bar</code></p><p>or</p><p><code>http://x/12345</code>.</p><p>These are short for (and resolve to) something else, like <code>https://example.com/go/foo-bar</code> or <code>https://example.com/x/reports/12345</code>.</p><p>One way to set this up is to use a proxy and something called <a href=https://en.wikipedia.org/wiki/Proxy_auto-config>Proxy Auto Configuration (PAC)</a>. A PAC file is a small snippet of Javascript that directs browsers to use a proxy for certain hostnames. For more details, see <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Proxy_servers_and_tunneling/Proxy_Auto-Configuration_PAC_file>MDN</a>.</p><p>Here&rsquo;s a simple setup for macOS using the <a href=https://caddyserver.com/>Caddy</a> proxy that will let you type <code>http://g/foo bar</code> and it will take you to <code>http://google.com/search?q=foo+bar</code>. (This example is a bit of a contrived, since all browsers today support querying a search engine in the URL bar, but it gets the idea across).</p><p>Install Caddy:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ brew install caddy
</span></span></code></pre></div><p>In a new file <code>proxyconfig.pac</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>FindProxyForURL</span>(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>host</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>host</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;g&#34;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;PROXY localhost:9999&#34;</span>;
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;DIRECT&#34;</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>For details on how the PAC file works, see the aforementioned MDN page.</p><p>Next, we&rsquo;ll configure Caddy to (a) serve a static PAC file, and (b) proxy <code>http://g</code> requests to Google. In a new file <code>caddyfile</code> in the same directory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span># Serve up the PAC file.
</span></span><span style=display:flex><span>http://localhost:9999 {
</span></span><span style=display:flex><span>    log
</span></span><span style=display:flex><span>    handle /proxyconfig.pac {
</span></span><span style=display:flex><span>        file_server {
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span># Rewrite http://g requests.
</span></span><span style=display:flex><span>http://g:9999 {
</span></span><span style=display:flex><span>    log
</span></span><span style=display:flex><span>    @mymatcher {
</span></span><span style=display:flex><span>        path_regexp /(.*)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    redir @mymatcher http://www.google.com/search?q={http.regexp.1}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span># Redirect requests for Google.
</span></span><span style=display:flex><span>http://, https:// {
</span></span><span style=display:flex><span>    redir {scheme}{hostport}{uri}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>(I&rsquo;m new to Caddy so the above may not be good form, secure, etc. You&rsquo;ve been warned.)</p><p>Start Caddy:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ caddy run
</span></span></code></pre></div><p>Install the PAC file on macOS by opening System Preferences, go to Network > Advanced > Proxies > Automatic Proxy Configuration. Set the Proxy Configuration File URL to <code>http://localhost:9999/proxyconfig.pac</code>.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><p>Now, you should be able to type in <code>g/foo bar</code> into your browser, hit enter, and it should direct you to Google&rsquo;s search results for &ldquo;foo bar&rdquo;. At least in Chrome, when you type it in, there may be two results in the drop-down suggestion list - you need to make sure to select the blue one (you should only need to do this once).</p><p>If you modify the PAC file, your browser may not immediately pick the change up. To force Chrome to do so, go to <a href=chrome://net-internals#proxy>chrome://net-internals#proxy</a> and click &lsquo;Re-apply settings&rsquo;.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><code>file:///path/to/proxyconfig.pac</code> does not seem to work (<a href=https://superuser.com/a/565071)>https://superuser.com/a/565071)</a>.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article></main><footer id=footer></footer><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script>
<script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]}}</script></body></html>